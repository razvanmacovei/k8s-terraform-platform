apiVersion: x402.io/v1alpha1
kind: X402Route
metadata:
  name: podinfo-payments
  namespace: podinfo
spec:
  ingressRef:
    name: podinfo
  payment:
    wallet: "0x4DEF22cad784C9fd21272e545F349Fea83BF8764"
    network: base-sepolia
    defaultPrice: "0.001"
    facilitatorURL: "https://x402.org/facilitator"
  routes:
    # Free routes — health checks and landing page
    - path: "/healthz"
      free: true
    - path: "/readyz"
      free: true
    - path: "/"
      free: true

    # Conditional route — free with valid API key, paid otherwise
    - path: "/api/info"
      mode: conditional
      conditions:
        - header: "X-Api-Key"
          pattern: "^sk-[a-zA-Z0-9]{32,}$"
          action: free

    # Conditional route — bots pay, browsers are free
    - path: "/api/echo"
      mode: conditional
      price: "0.002"
      conditions:
        - header: "User-Agent"
          pattern: "(?i)(curl|wget|python|go-http|httpie|postman)"
          action: pay
        - header: "User-Agent"
          pattern: "(?i)(mozilla|chrome|safari|firefox|edge)"
          action: free

    # Premium endpoint — higher price
    - path: "/api/headers"
      price: "0.005"

    # Catch-all paid API routes
    - path: "/api/*"
